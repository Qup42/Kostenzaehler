<html>
    <head>
        <link rel="stylesheet" href="css/flipTimer.css" />
        <style>
            body {
                background-color: #b8d6df;
            }
            .flipTimer {
                margin: 100px 100px 0;
            }
        </style>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

        <script>

            /**
             * Erstellt n Klappuhr Ziffern
             * @param {number} from Anfangswert der Werte dieser Stelle (meist 0)
             * @param {number} to   Endwert der Werte dieser Stelle (meist 9)
             * @param {number} n    Anzahl der zu erstellenden Ziffern
             */
            function createDigits(from, to, n)
            {
                for(j=n-1; j >= 0; j--)
                {
                    setUpDigit(from, to, j);
                }
            }

            /**
             * Fügt dem div der Klasse flipTimer eine Klappuhr Ziffer hinzu.
             * @param {number} from Anfangswert der Werte dieser Stelle (meist 0)
             * @param {number} to   Endwert der Werte dieser Stelle (meist 9)
             * @param {number} n    eindeutiger, fortlaufende Index dieser Stelle
             */
            function setUpDigit(from, to, n)
            {
                $div = $(".flipTimer");
                $builtHtml = '<div class="digit-set" id="'+n+'">'
                for(i=from; i <= to; i++)
                {
                    $builtHtml += '<div class="digit"><div class="digit-top"><span class="digit-wrap">'+i+'</span></div><div class="shadow-top"></div><div class="digit-bottom"><span class="digit-wrap">'+i+'</span></div><div class="shadow-bottom"></div></div>'
                }
                $builtHtml += '</div>'

                $div.append($builtHtml)

                $div.find("div#"+n).children().first().addClass("active");
                $div.find("div#"+n).children().last().addClass("previous").addClass("last");
            }

            /**
             * Setzt die Stellen mit den Indizis von from bis to auf nicht übertragend. D.h. dass bei einem Überlauf von 9 auf 0 nichts weiter passiert. Die nächste Stelle wird *nicht* um 1 erhöht.
             * @param {number} from Der Anfangsindex (inklusiv)
             * @param {number} to   Der Endindex (inklusiv)
             */
            function setIndeterminate(from, to)
            {
                for(i=from; i <= to; i++)
                {
                    $("div#"+i).children().last().addClass("indeterminate")
                }
            }

            /**
             * Setzt die Stellen mit den Indizis von from bis to auf übertragend. D.h. dass bei einem Überlauf von 9 auf 0 die nächste Stelle um 1 erhöht wird.
             * @param {number} from Der Anfangsindex (inklusiv)
             * @param {number} to   Der Endindex (inklusiv)
             */
            function setDeterminate(from, to)
            {
                for(i=from; i <= to; i++)
                {
                    $("div#"+i).children().last().removeClass("indeterminate")
                }
            }

            /**
             * Setzt die jeweilige Stelle auf den nächsten Wert. Nach 9 wird wider bei 0 angefangen.
             * Ein automatischer Übertrag auf die nächste Stelle findet statt, kann aber abgestellt werden.
             * @param {object} el Das Div Element mit der Klasse digit-set dessen Stelle inkrementiert werden soll
             */
            function tickElement(el)
            {
                $current = el.find(".active")
                el.find(".previous").removeClass("previous")
                $current.removeClass("active").addClass("previous")
                if($current.hasClass("last"))
                {
                    $current.parent().children().first().addClass("active")
                    if(!$current.hasClass("indeterminate"))
                    {
                        tickElement($current.parent().prev())
                    }
                }
                else
                {
                    $current.next().addClass("active")
                }
            }

            /**
             * Setzt die jeweilige Stelle auf den nächsten Wert. Nach 9 wird wider bei 0 angefangen.
             * Ein automatischer Übertrag auf die nächste Stelle findet statt, kann aber abgestellt werden.
             * @param {number} n Index der Stelle von hinten
             */
            function tick(n)
            {
                $div = $(".flipTimer").find("div#"+n);
                $current = $div.find(".active")
                $div.find(".previous").removeClass("previous")
                $current.removeClass("active").addClass("previous")
                if($current.hasClass("last"))
                {
                    $current.parent().children().first().addClass("active")
                    if(!$current.hasClass("indeterminate"))
                    {
                        tickElement($current.parent().prev())
                    }
                }
                else
                {
                    $current.next().addClass("active")
                }
            }

            $(document).ready(function() {
                createDigits(0, 9, 10);

                $speed = 1234567;
                setIndeterminate(0, 5)

                setInterval(function() {
                    tick(0);
                }, 1000/7);
                setInterval(function() {
                    tick(1);
                }, 1000/6);
                setInterval(function() {
                    tick(2);
                }, 1000/5);
                setInterval(function() {
                    tick(3);
                }, 1000/4);
                setInterval(function() {
                    tick(4);
                }, 1000/3);
                setInterval(function() {
                    tick(5);
                }, 1000/2);
                setInterval(function() {
                    tick(6);
                }, 1000/1);
            });
        </script>
    </head>
    <body>
        <div class="flipTimer">
        </div>
    </body>
</html>
